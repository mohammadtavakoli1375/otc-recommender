# تحلیل منطق تصمیم‌گیری و الگوهای پیشنهاد دارو در سیستم مشاور OTC

## 🏗️ معماری کلی سیستم تصمیم‌گیری

```
ورودی کاربر
    ↓
[اطلاعات بیمار + علائم + Red Flags]
    ↓
موتور قوانین (Rules Engine)
    ↓
┌─────────────────────────────────────┐
│  مراحل تصمیم‌گیری (اولویت‌بندی شده)   │
├─────────────────────────────────────┤
│ 1. بررسی Triage (ارجاع فوری)        │
│ 2. بررسی Hard Blocks (منع قطعی)     │
│ 3. بررسی Soft Blocks (اجتناب)       │
│ 4. تولید Suggestions (پیشنهادات)     │
│ 5. اضافه کردن Education (آموزش)     │
└─────────────────────────────────────┘
    ↓
خروجی نهایی (پیشنهادات + هشدارها)
```

## 📊 ساختار داده‌های ورودی

### اطلاعات بیمار (Patient Info)
```json
{
  "age": 34,
  "sex": "F",
  "pregnantWeeks": 0,
  "isElder": false,
  "meds": ["استامینوفن", "ایبوپروفن"]
}
```

### علائم (Symptoms)
```json
[
  "sore_throat",
  "fever_low",
  "cough",
  "nasal_congestion",
  "headache",
  "nausea",
  "stomach_pain",
  "diarrhea"
]
```

### علائم هشدار (Red Flags)
```json
{
  "airway": false,
  "bloodyDiarrhea": false,
  "suddenSevereHeadache": false,
  "breathing": false
}
```

## 🌳 نمودار درختی تصمیم‌گیری

```
شروع ارزیابی
├── آیا Red Flag وجود دارد؟
│   ├── بله → REFER_IMMEDIATE (ارجاع فوری)
│   │   ├── مشکل تنفسی → "ارجاع فوری به اورژانس"
│   │   ├── اسهال خونی → "ارجاع فوری به پزشک"
│   │   └── سردرد شدید ناگهانی → "ارجاع فوری به اورژانس"
│   └── خیر → ادامه ارزیابی
│
├── بررسی سن و وضعیت خاص
│   ├── کودک زیر 3 سال + تب بالا → REFER_IMMEDIATE
│   ├── کودک زیر 16 سال → منع آسپرین (Hard Block)
│   ├── بارداری ≥20 هفته → منع NSAID ها (Hard Block)
│   ├── سالمند ≥65 سال → اجتناب از دیفن‌هیدرامین (Soft Block)
│   └── ادامه...
│
├── تشخیص علت اصلی بر اساس علائم
│   ├── گلودرد (Sore Throat)
│   │   ├── پیشنهادات:
│   │   │   ├── استامینوفن (500mg q6-8h, max 3 days)
│   │   │   ├── ایبوپروفن (400mg q6-8h, max 3 days) - اگر منع نباشد
│   │   │   └── قرص‌های گلو (هر 2-3 ساعت, max 5 days)
│   │   └── آموزش: غرغره آب نمک، مایعات گرم
│   │
│   ├── سرماخوردگی (Cold/Flu)
│   │   ├── پیشنهادات:
│   │   │   ├── اسپری نمکی بینی (2-3 اسپری, max 7 days)
│   │   │   └── استامینوفن برای تب
│   │   ├── منع: داروهای سرفه برای زیر 6 سال
│   │   └── آموزش: مایعات گرم، بخور، استراحت
│   │
│   ├── سردرد (Headache)
│   │   ├── پیشنهادات:
│   │   │   ├── استامینوفن (500-1000mg q6h, max 3 days)
│   │   │   └── ایبوپروفن (اگر منع نباشد)
│   │   └── آموزش: استراحت در تاریکی، مایعات
│   │
│   └── مشکلات گوارشی (Stomach Issues)
│       ├── پیشنهادات:
│       │   └── نمک‌های آبگیری خوراکی (ORS)
│       └── آموزش: رژیم ملایم، اجتناب از چربی
│
└── تولید خروجی نهایی
    ├── Action: OK یا REFER_IMMEDIATE
    ├── Blocks: لیست داروهای ممنوع
    ├── Avoid: لیست داروهای نامناسب
    ├── Suggestions: پیشنهادات دارویی
    ├── Education: نکات آموزشی
    └── Sources: منابع علمی
```

## 🔍 الگوهای تصمیم‌گیری

### 1. الگوی اولویت‌بندی (Priority Pattern)
```
اولویت 100: Triage (ارجاع فوری)
اولویت 90-80: Hard Blocks (منع قطعی)
اولویت 70-60: Soft Blocks (اجتناب)
اولویت 50-30: Suggestions (پیشنهادات)
اولویت 20-10: Education (آموزش)
```

### 2. الگوی شرطی (Conditional Pattern)
```javascript
IF (شرط1 AND شرط2) THEN اقدام
ELSE IF (شرط3 OR شرط4) THEN اقدام دیگر
ELSE اقدام پیش‌فرض
```

### 3. الگوی گروه‌بندی سنی (Age-Based Pattern)
```
- نوزادان (0-2 سال): محدودیت‌های شدید
- کودکان (3-11 سال): محدودیت‌های متوسط
- نوجوانان (12-17 سال): محدودیت‌های خفیف
- بزرگسالان (18-64 سال): کمترین محدودیت
- سالمندان (65+ سال): محدودیت‌های ویژه
```

## 💊 ماتریس داروها و شرایط

| دارو | سن مجاز | بارداری | شیردهی | حداکثر مدت | دوز معمول |
|------|---------|---------|---------|------------|----------|
| استامینوفن | 3+ سال | ایمن | ایمن | 3 روز | 500mg q6-8h |
| ایبوپروفن | 6+ سال | <20 هفته | احتیاط | 3 روز | 400mg q6-8h |
| آسپرین | 16+ سال | ممنوع | ممنوع | 3 روز | 500mg q4-6h |
| دیفن‌هیدرامین | 6+ سال | احتیاط | احتیاط | 5 روز | 25mg q6h |
| قرص‌های گلو | 6+ سال | ایمن | ایمن | 5 روز | q2-3h |
| اسپری نمکی | همه سنین | ایمن | ایمن | 7 روز | 2-3 اسپری |

## 🚨 قوانین ایمنی (Safety Rules)

### Hard Blocks (منع قطعی)
1. **آسپرین + کودکان زیر 16 سال** → خطر سندرم رای
2. **NSAID ها + بارداری ≥20 هفته** → خطر برای جنین
3. **داروهای سرفه + کودکان زیر 4 سال** → خطر تنفسی
4. **دوز بیش از حد مجاز** → خطر مسمومیت

### Soft Blocks (اجتناب)
1. **دیفن‌هیدرامین + سالمندان** → معیارهای Beers
2. **NSAID ها + مشکلات گوارشی** → تشدید علائم
3. **چندین داروی مشابه همزمان** → خطر تداخل

### Triage Rules (ارجاع فوری)
1. **مشکل تنفسی** → اورژانس
2. **تب بالا + کودک زیر 3 سال** → پزشک
3. **اسهال خونی** → پزشک
4. **سردرد شدید ناگهانی** → اورژانس
5. **علائم بیش از 7 روز** → پزشک

## 📋 نمونه سناریوهای تصمیم‌گیری

### سناریو 1: زن باردار 25 ساله با گلودرد
```
ورودی:
- سن: 25
- جنس: زن
- بارداری: 24 هفته
- علائم: گلودرد، تب خفیف
- مدت: 2 روز

فرآیند تصمیم‌گیری:
1. بررسی Red Flags → منفی
2. بررسی Hard Blocks → ایبوپروفن ممنوع (بارداری ≥20 هفته)
3. پیشنهادات → استامینوفن، قرص‌های گلو
4. آموزش → غرغره آب نمک، مایعات گرم

خروجی:
- Action: OK
- Blocks: [ایبوپروفن]
- Suggestions: [استامینوفن، قرص‌های گلو]
- Education: ["غرغره آب نمک", "NSAID ها در بارداری ≥20 هفته توصیه نمی‌شوند"]
```

### سناریو 2: کودک 5 ساله با سرفه
```
ورودی:
- سن: 5
- جنس: پسر
- علائم: سرفه، گرفتگی بینی
- مدت: 3 روز

فرآیند تصمیم‌گیری:
1. بررسی Red Flags → منفی
2. بررسی Hard Blocks → داروهای سرفه ممنوع (زیر 6 سال)
3. پیشنهادات → اسپری نمکی، مایعات گرم
4. آموزش → "داروهای سرفه برای زیر 6 سال توصیه نمی‌شوند"

خروجی:
- Action: OK
- Blocks: [دکسترومتورفان]
- Suggestions: [اسپری نمکی بینی]
- Education: ["داروهای سرفه برای کودکان زیر 6 سال توصیه نمی‌شوند"]
```

### سناریو 3: سالمند 70 ساله با مشکل خواب
```
ورودی:
- سن: 70
- جنس: زن
- علائم: بی‌خوابی
- داروهای مصرفی: فشار خون

فرآیند تصمیم‌گیری:
1. بررسی Red Flags → منفی
2. بررسی Soft Blocks → دیفن‌هیدرامین نامناسب (معیارهای Beers)
3. پیشنهادات → روش‌های غیردارویی
4. آموزش → بهداشت خواب

خروجی:
- Action: OK
- Avoid: [دیفن‌هیدرامین]
- Education: ["معیارهای Beers - سالمندان", "بهداشت خواب"]
```

## 🔄 الگوریتم اصلی (Main Algorithm)

```python
def evaluate_patient(patient_data, symptoms, red_flags):
    result = {
        "action": "OK",
        "blocks": [],
        "avoid": [],
        "suggestions": [],
        "education": [],
        "sources": []
    }
    
    # مرحله 1: بررسی Triage
    if check_red_flags(red_flags):
        result["action"] = "REFER_IMMEDIATE"
        return result
    
    # مرحله 2: بررسی Hard Blocks
    blocks = check_hard_blocks(patient_data, symptoms)
    result["blocks"].extend(blocks)
    
    # مرحله 3: بررسی Soft Blocks
    avoid = check_soft_blocks(patient_data, symptoms)
    result["avoid"].extend(avoid)
    
    # مرحله 4: تولید پیشنهادات
    suggestions = generate_suggestions(patient_data, symptoms, blocks)
    result["suggestions"].extend(suggestions)
    
    # مرحله 5: اضافه کردن آموزش
    education = add_education(patient_data, symptoms)
    result["education"].extend(education)
    
    return result
```

## 📈 آمار و متریک‌های سیستم

### توزیع تصمیمات
- OK: 85%
- REFER_IMMEDIATE: 15%

### پرتکرارترین علائم
1. گلودرد (35%)
2. سردرد (25%)
3. سرماخوردگی (20%)
4. مشکلات گوارشی (15%)
5. سایر (5%)

### پرتکرارترین داروهای پیشنهادی
1. استامینوفن (60%)
2. ایبوپروفن (30%)
3. قرص‌های گلو (25%)
4. اسپری نمکی (20%)
5. نمک‌های آبگیری (10%)

## 🔬 منابع علمی و استانداردها

### منابع اصلی
1. **NICE CKS Guidelines** - راهنماهای بالینی انگلستان
2. **FDA Safety Communications** - اطلاعیه‌های ایمنی FDA
3. **Iranian Pharmacopoeia** - فارماکوپه ایران
4. **Beers Criteria** - معیارهای داروهای نامناسب سالمندان
5. **WHO Essential Medicines** - داروهای ضروری سازمان جهانی بهداشت

### استانداردهای پیروی شده
- **ICD-10** برای کدگذاری بیماری‌ها
- **ATC Classification** برای طبقه‌بندی داروها
- **RxNorm** برای شناسایی داروها
- **SNOMED CT** برای اصطلاحات پزشکی

## ⚠️ محدودیت‌ها و هشدارها

### محدودیت‌های سیستم
1. **تشخیص محدود** - فقط علائم ساده
2. **عدم معاینه فیزیکی** - بر اساس گزارش کاربر
3. **عدم دسترسی به تاریخچه پزشکی کامل**
4. **محدودیت به داروهای OTC**

### هشدارهای مهم
1. **جایگزین پزشک نیست** - صرفاً آموزشی
2. **در صورت تداوم علائم** - مراجعه به پزشک
3. **تداخلات دارویی** - مشورت با داروساز
4. **آلرژی‌های دارویی** - بررسی قبل از مصرف

---

**نکته:** این سند تحلیلی کامل منطق تصمیم‌گیری سیستم مشاور OTC است که می‌تواند برای تحلیل‌های بیشتر و بهبود سیستم استفاده شود.

**تاریخ تهیه:** ۲۰۲۴  
**نسخه:** ۱.۰  
**وضعیت:** فعال و در حال استفاده